<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Agent - India Business Daily</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“°</text></svg>">
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <header class="header">
            <h1>ðŸ“° India Business Daily</h1>
            <p>AI-powered news aggregation and insights</p>

            <div class="stats">
                <div class="stat-item">
                    <span class="stat-number">{{ total_items }}</span>
                    <span class="stat-label">Stories Today</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ categorized_news.keys()|length }}</span>
                    <span class="stat-label">Categories</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">{{ last_updated }}</span>
                    <span class="stat-label">Last Updated</span>
                </div>
            </div>

            <a href="/refresh" class="refresh-btn" onclick="refreshNews(event)">
                ðŸ”„ Refresh News
            </a>
        </header>

        <!-- Main Content -->
        <main>
            {% if categorized_news %}
                {% for category_key, category_data in categorized_news.items() %}
                <section class="category-section">
                    <div class="category-header">
                        <div class="category-icon" style="background-color: {{ category_data.color }};"></div>
                        <h2 class="category-title">{{ category_data.name }}</h2>
                        <span class="category-count">{{ category_data.articles|length }} stories</span>
                    </div>

                    <div class="cards-grid">
                        {% for item in category_data.articles %}
                        <article class="news-card" style="border-left-color: {{ category_data.color }};">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <a href="{{ item.link }}" target="_blank" rel="noopener">
                                        {{ item.title }}
                                    </a>
                                </h3>
                                <div class="card-source">{{ item.source }}</div>
                            </div>

                            <div class="card-content">
                                <p class="card-summary">{{ item.one_liner }}</p>

                                {% if item.bullets %}
                                <ul class="card-bullets">
                                    {% for bullet in item.bullets %}
                                    <li>{{ bullet }}</li>
                                    {% endfor %}
                                </ul>
                                {% endif %}
                            </div>

                            <div class="card-footer">
                                <div class="card-labels">
                                    {% for label in item.labels %}
                                    <span class="label-tag">{{ label }}</span>
                                    {% endfor %}
                                </div>
                                <a href="{{ item.link }}" target="_blank" rel="noopener" class="source-link">
                                    Read More â†’
                                </a>
                            </div>
                        </article>
                        {% endfor %}
                    </div>
                </section>
                {% endfor %}
            {% else %}
                <div class="loading">
                    <p>No news available. Try refreshing to fetch the latest stories.</p>
                </div>
            {% endif %}
        </main>
    </div>

    <!-- JavaScript for interactivity -->
    <script>
        async function refreshNews(event) {
            event.preventDefault();

            const btn = event.target;
            const originalText = btn.innerHTML;

            // Show loading state
            btn.innerHTML = 'ðŸ”„ Refreshing...';
            btn.classList.add('refreshing');
            btn.style.pointerEvents = 'none';

            try {
                const response = await fetch('/refresh');
                const result = await response.json();

                if (result.status === 'success') {
                    // Reload the page to show new data
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                } else {
                    throw new Error(result.message || 'Failed to refresh');
                }
            } catch (error) {
                console.error('Refresh failed:', error);
                alert('Failed to refresh news. Please try again.');

                // Reset button
                btn.innerHTML = originalText;
                btn.classList.remove('refreshing');
                btn.style.pointerEvents = 'auto';
            }
        }

        // Auto-refresh every 30 minutes
        setInterval(() => {
            fetch('/refresh')
                .then(response => response.json())
                .then(result => {
                    if (result.status === 'success') {
                        // Show subtle notification that data was updated
                        showNotification('News updated automatically');
                        setTimeout(() => window.location.reload(), 2000);
                    }
                })
                .catch(console.error);
        }, 30 * 60 * 1000); // 30 minutes

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #10B981;
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 1000;
                font-weight: 500;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateY(-20px)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Add smooth scrolling for better UX
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Add loading animation on external links
        document.querySelectorAll('a[target="_blank"]').forEach(link => {
            link.addEventListener('click', function() {
                this.style.opacity = '0.7';
                setTimeout(() => {
                    this.style.opacity = '1';
                }, 500);
            });
        });
    </script>
</body>
</html>